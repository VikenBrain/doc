





# MySQL

## 简介

1. 什么是数据库？什么是数据库管理系统？什么事SQL？他们之间的关系是什么？

    数据库：

    简称DB，按照一定格式存储数据的一些文件组合。

    数据库管理系统：

    DataBaseManagement，简称DBMS。专门来管理数据库中的数据，数据库管理系统可以对数据库当中的数据进行增删改查。常见的MySQL、Oracle...

    SQL：

    结构化查询语言。程序员编写SQL语句，然后DBMS负责执行SQL语句，最终来完成数据库中数据的增删改查。

    关系：

    DBMS——>执行SQL——>DB

    

## 安装

略

## 操作

### 常用命令

#### db 数据库

```python
show databases; # 查看数据库, 默认带了4个
use test; # 使用数据库
create databases test_01; # 创建一个数据库
```

#### table 表

1. 行(row): 数据/记录

2. 列(column): 字段

    字段名、数据类型，约束(唯一值...)

```python
show tables; # 查看表
```

##### 表的设计

1. 三大范式与反范式
2. 适度冗余，让query尽量减少Join
3. 大字段垂直分拆
4. 大表水平分拆
5. 选择合适的数据类型



#### SQL



##### DQL

数据查询语言(凡是带有select关键字的都是查询语言)

##### DML



##### DDL



##### TCL



##### DCL



## 面试题

### 数据库三范式

第一范式：确保每列的原子性，每列都是不可分割的最小数据单元；

第二范式：在第一范式的基础上，要求每列都和主键相关；

第三范式：在第二范式的基础上，要求其他列和主键是直接相关，而不是间接相关。

### 分别说下范式/反范式的优缺点

|      | 范式                                                         | 反范式                                               |
| ---- | ------------------------------------------------------------ | ---------------------------------------------------- |
| 优点 | 1. 减少数据冗余 <br />2. 表中重复数据较少重新操作比较快 <br />3. 范式化的表通常比反范式化的表小 | 1. 可以减少表的关联<br />2. 更好的进行索引优化       |
| 缺点 | 1. 在查询的时候通常需要很多的关联，降低性能<br />2. 增加了索引的优化难度 | 1. 数据重复冗余<br />2. 对数据表的修改需要更多的成本 |

### 索引，B数和B+数的区别

MySQL数据库索引和存储引擎有关，MyISAM和InnoDB只支持BTREE索引。MEMORY和HEAP支持HASH和BTREE索引

B数和B+数的区别

1. B+树非叶子节点只存储关键字和指向子节点的指针，而B树还存储了数据，在同样大小的情况下，B+树可以存储更多的关键字
2. B+树叶子节点存储了所有关键字和数据，并且多个节点用链表连接。可以快速支撑范围查找
3. B+树非叶子节点不存储数据，所以查询时间复杂度固定为O(logN)，B树查询时间复杂度不固定，最好是O(1)

为什么 B+ 树比 B 树更适合应用于数据库索引，除了数据库索引，还有什么地方用到了（操作系统的文件索引）？

因为B树叶子节点和非叶子结点都存储了数据，这样就导致了非叶子结点能保存的关键字和指针变少，如果要保存大量数据，只能增加树的高度，导致IO操作变多，查询性能降低除数据库索引，还有操作系统的文件索引用到了B树。

### 事务如何实现

事务是一个操作序列，要么不执行，要么全部执行。

特点：

1. 原子性(A)

    通过`undo log`实现的。每条数据变更都伴随一条`undo log`日志的生成，当系统发生错误或执行回滚根据`undo log`做逆向操作

2. 一致性(C)

    通过`redo log`实现的。`redo log`记录了数据的修改日志。数据持久化到磁盘，先是储存到缓冲池里，然后缓冲池中的数据定期同步到磁盘中，如果系统宕机，可能会丢失数据，系统重启后会读取redo log恢复数据

3. 隔离性(I)

    mysql数据库通过`MVCC + next-key`机制实现了隔离性

4. 持久性(D)

    以上3大特性，保障了事务的一致性

### 隔离等级

### 什么情况下不会用到数据库索引？

默认SQL语句进行的是全表扫描，遇到匹配条件就加入搜索结果合集。

### 关系型数据库和非关系型数据库的优缺点？

|      | 关系型数据库                                                 | 非关系型数据库                                               |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 优点 | 1. 二维表格，容易理解<br />2. 操作方便<br />3. 易于维护<br />4. 支持SQL | 1. 不需要SQL解析，读写性能高<br />2. 可以使用硬盘或者内存作为载体，速度快<br />3. 基于键值对，数据没有耦合性，方便扩展<br />4. 部署简单 |
| 缺点 | 1. 读写性能较差<br />2. 固定的表结构，不够灵活<br />3. 应对高并发场景，磁盘I/O存在瓶颈<br />4. 海量数据的读写性能差 | 1. 不支持SQL<br />2. 没有事务                                |
| 其他 |                                                              |                                                              |

### 什么情况下MySQL查询慢？

1. 没有设置索引，或查询没有用到索引
2. I/O吞吐量过小
3. 内存不足
4. 网络速度慢
5. 查询数据量太大
6. 锁或死锁
7. 返回不必要的行或者列
8. 查询语句问题，需要优化

慢查询日志

```python
# 默认是关闭的，如果非必要，不要开启，影响性能
SHOW VARIABLES LIKE 'slow_query%';
slow_query_log，慢查询开启关闭状态
slow_query_log_file，慢查询日志存储位置，用文本编辑器打开存储位置的文件，查询慢查询
```

### 查询慢处理方式

1. 把数据、日志、索引放到不同的I/O设备上，增加读取速度
2. 纵向、横向分割表，减少表的尺寸
3. 升级硬件
4. 根据查询条件，建立索引，索引优化
5. 提高网速
6. 扩大服务器内存
7. 分库分表

### varchar和char?

`varchar`会根据存储的内容改变长度，`char`是定长，如果长度不够，则使用空格补齐

### Mysql 中插入数据使用自增 id 好还是使用 uuid？

1. 单实例或单节点组，不担心网络爬虫获取数据量，推荐使用自增id，性能更好
2. 分布式场景。20个节点下的小规模分布式场景，推荐uuid。20~200个节点的中规模分布式场景，推荐自增id+步长的策略。200以上节点，推荐推特雪花算法的全局自增ID

### 组建Mysql集群